var data = "Folder PATH listing for volume BOOTCAMP\nVolume serial number is 00000090 CA25:8764\nC:.\n|   filelog.txt\n|   isinstalled.txt\n|   \n+---empty\n+---errors\n|       errorlog.txt\n|       screencapture.log\n|       \n\\---projects\n    \\---1\n        |   1.jpg\n        |   1.xml\n        |   \n        +---final\n        |       final.wmv\n        |       \n        +---media\n        |       01792f6d-77c1-4b35-ba3a-4a905d2b8011.WMV\n        |       0c4da9e8-6bc6-41d7-b887-d6f93b6ef389.WMV\n        |       1b81c92a-ab36-4205-880d-8362e5b70f4a.WMV\n        |       213ced6d-8b0e-4ecf-9ce8-889fe2be1f49.WMV\n        |       2737e7de-d33f-48c9-ba8e-a898cee33801.WMV\n        |       37e67f16-4a76-4b65-b1b6-794daeca3bc1.WMV\n        |       4cc8c525-5d96-41cd-a42d-8b69afb243fc.WMV\n        |       4fcdbae3-52e5-4b31-8563-4935d9c837e9.WMV\n        |       53cce6f5-8490-4a0f-ae85-682ed1d03f33.WMV\n        |       59434ba8-d06b-41cd-9668-52a7e3a28f31.WMV\n        |       6253c441-3299-4aba-a006-ea068b287d43.WMV\n        |       627cbd00-a807-4d30-8849-ba0f8e1fd7c7.WMV\n        |       6abae923-dfae-43f6-9532-eb9ae95d9955.WMV\n        |       6f45d15d-9752-42a4-9c98-ef844c96ab00.WMV\n        |       73b58e33-afb5-4de8-af89-095e5f978a14.WMV\n        |       748e5b5a-93c1-45b9-b761-5b2058c8b687.WMV\n        |       81eda27a-30f5-4913-8641-9d22578659c0.WMV\n        |       83cc584a-f882-46e5-80ee-0b3ddba6b91b.WMV\n        |       8687df9b-d40c-4e0b-ab81-45833cf390b3.WMV\n        |       8950d105-bf52-4264-bc7f-4aa8bba7d825.WMV\n        |       98111e71-2f30-4781-bd0a-8193ff46b26f.WMV\n        |       988ec7cd-dbe5-4d4b-a536-4c0e3d504131.WMV\n        |       9a8b217c-5aa4-4915-910d-8aff2305dfec.WMV\n        |       9bf81f3a-0f15-4f51-a636-23827ab097c7.WMV\n        |       ab92f720-41b4-4900-9525-62bfcb08080d.WMV\n        |       b287d3cd-9249-41bc-83d4-de8b7a75434f.WMV\n        |       b952ea6d-ff7b-4a33-a2b8-cb0599ae304c.WMV\n        |       c346936c-c20a-497a-8a85-e9e445d7866b.WMV\n        |       ca1cc36e-54c8-467c-bd7e-e08b9b831f48.WMV\n        |       cc608a69-65cb-4e8c-8f22-d8507d6654fd.WMV\n        |       d81c03d2-417b-4244-9986-3b46a27a43ad.WMV\n        |       dc1d5863-570e-4bcc-8d8a-1020a56c02a8.WMV\n        |       e21a1ebf-cc03-4059-921a-8050dd50c896.WMV\n        |       ed68ab66-7a26-455c-a8cf-4d5dd1cadbb1.WMV\n        |       ee6a9dd5-dad2-499e-8409-067f1c738fbb.WMV\n        |       f1177a62-7bb7-4e0b-8c2d-ca61912bf3f8.WMV\n        |       f89ea6e9-3976-47cb-b7d4-91c285388bcf.WMV\n        |       fa7c23c2-7549-4eb1-ac83-561842393780.WMV\n        |       fabcf345-8038-4267-8dae-e2eb20914f82.WMV\n        |       \n        \\---thumbnails\n                02ed6076-6f33-49be-953a-67aff823b3e6.jpg\n                060915a3-7c83-4073-83fb-b1a50361b130.jpg\n                1807b1d9-c07c-4533-ad57-573b901ba1ff.jpg\n                3183a8d6-7439-4340-9a92-fb0b818afecd.jpg\n                3a9832ea-d1e3-4dd2-99a5-cdb9625a25d8.jpg\n                3c45a4fd-3880-4876-9f64-b84b2c32097f.jpg\n                3cefe92e-c300-4eda-b3fe-fbbb72f937f1.jpg\n                440575b2-769a-4448-a02a-8a3e7903af0d.jpg\n                508ef0de-7908-4a89-a7b2-233f1266770c.jpg\n                611c2740-03d4-4be7-928b-69a02cee806d.jpg\n                66e5f12c-0e01-4fd5-97a9-d1fac76a44cb.jpg\n                6aa2e1fa-97d2-429b-a0a5-fd40c771feab.jpg\n                9600edf0-86a1-41b4-a218-fc7f57b37417.jpg\n                a2e92311-be83-4d3e-9142-5447b220731c.jpg\n                a4bbe202-0664-4ed3-905f-b1ece807556b.jpg\n                aff133d2-ed47-41cb-82c6-5b6b3128c9fb.jpg\n                bdde9ac5-54b5-4df7-9cd8-1072907b2693.jpg\n                bebaa894-3533-4ba0-9aeb-48e5cf58d94e.jpg\n                c8361f4e-7df8-4d73-891e-fe00b2c3a27a.jpg\n                d5ca0506-ba4f-47ef-a7ad-31415276c83a.jpg\n                db115f5b-990a-4d86-82ec-cfbe9286db2a.jpg\n                dbd54c96-6f75-4267-b68b-ebf942de842e.jpg\n                e6c0dd8a-8d8c-4b97-b0de-6dbbfc27d253.jpg\n                \n";

function getLineType(line) {
    var fileRegex = /(^|(?<=\n))(( |\|)   )+[^| \\+]+(\n|$)/;
    var nonLastFolderRegex = /(^|(?<=\n))[\t ]*\+---[a-zA-Z0-9._-]+/;
    var lastFolderRegex = /(^|(?<=\n))[\t ]*\\---[a-zA-Z0-9._-]+/;
    var endOfFilesRegex = /(^|(?<=\n))(( |\|)   )+(\n|$)/;

    switch(true)
    {
        case fileRegex.test(line):
            return "file";
        case nonLastFolderRegex.test(line):
            return "nonLastFolder";
        case lastFolderRegex.test(line):
            return "lastFolder";
        case endOfFilesRegex.test(line):
            return "endOfFolder";
        default:
            return "comment";
    }
}

function processLines(lines, i) {
    var obj = {
        files:[],
        folders:[]
    };

    while(getLineType(lines[i]) == "comment")  {
        i++;
    }

    while(getLineType(lines[i]) == "file")  {
        obj.files.push(lines[i]);
        i++;
    }

    if(obj.files.length > 0 && getLineType(lines[i]) != "endOfFolder") {
        console.log(getLineType(lines[i]));
        console.log(lines[i]);
        throw new Error();
    }

    i++;

    while(getLineType(lines[i]) == "nonLastFolder") {
        i++;

        if(getLineType(lines[i]) == "file") {
            obj.folders.push({"a": processLines(lines, i)});
        } else {
            obj.folders.push({"a": {}});
        }
    }

    if(getLineType(lines[i]) != "lastFolder") {
        console.log(getLineType(lines[i]));
        console.log(lines[i]);
        throw new Error();
    }

    i++;
    obj.folders.push({"a": processLines(lines, i)});

    return obj;
}

var lines = data.split("\n");
console.log(processLines(lines, 0));
